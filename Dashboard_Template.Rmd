---
title: "Dashboard Template"
author: "Jemma Marcus-Shi and Linjie Zhu"
date: "`r Sys.Date()`"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
---

# Questions and Written Insights 

### Question 1: Students' average salary by region/state

We will calculate the average salary for students by state or region, depending on the differences we find after analysis. The graph will only show the 10 states have the highest average salaries since there are too many states.

### Question 2: City rank by job opportunities

We will summarize the number of students employed by city and rank those cities by frequency. Thus, we can find which cities give our students the most job opportunities. It will also allow our client to be aware of which cities should be the focus of fundraising efforts. 

# Region/State by Average Salaries {data-orientation="columns"}

```{r,echo=FALSE}
library(dplyr)
library(readr)
library(magrittr)

df <- read.csv('FSB_Survey1.csv')
cities = read.csv('uscities.csv')
```

```{r}
df <- df %>% mutate(city_state = paste(survey_city, ", ", survey_state))
cities <- cities %>% mutate(city_state = paste(city, ", ", state_id))
```

```{r}
df_final <- left_join(df, cities %>% select(city_state, lat, lng), by = "city_state")
```

```{r}
head(df_final)
df %>% count(city_state) %>% arrange(desc(n)) %>% head(10)
```

```{r}
grouped_data <- df %>%
  group_by(survey_state) %>% 
  summarize(AvgSalary = mean(survey_salary),
            OfferCount = n()) %>%  
  filter(OfferCount >= 10) 
```


## Column {data-width="400"}

### Add Bar Charts and/or Scatterplot Map to show Highest Region/State

```{r,echo=FALSE}
library(ggplot2)

# Sort the grouped data by AvgSalary in descending order
grouped_data <- grouped_data %>%
  arrange(desc(AvgSalary))

# Take the top 10 states
top_10_states <- head(grouped_data, 10)

# Create a bar chart for the top 10 states
ggplot(top_10_states, aes(x = reorder(survey_state, -AvgSalary), y = AvgSalary)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "State", y = "Average Salary") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# City Rank by Job Opportunities {data-orientation="columns"}

```{r}
offers_by_city <- df_final %>%
  group_by(city_state) %>%  
  summarize(Offer_Count = n())

ranked_offers <- offers_by_city %>%
  arrange(desc(Offer_Count)) %>%
  mutate(Rank = row_number())
```

## Column {data-width="400"}

### Add Bar Charts

```{r,echo=FALSE}
library(ggplot2)

top_10_cities <- head(ranked_offers, 10)

# Create a bar chart for the top 10 cities
ggplot(top_10_cities, aes(x = reorder(city_state, -Offer_Count), y = Offer_Count)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "City", y = "Job Opportunities") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
## Column {data-width="400"}
```{r}
### this doesn't work
library(leaflet)

# Create a leaflet map for the top 10 cities
m <- leaflet(data = df_final) %>%
  addTiles() %>%
  setView(lng = -98, lat = 39, zoom = 4) %>%
  addCircleMarkers(
    radius = 8,
    color = "blue",
    label = ~city_state,
    lat = ~lat,
    lng = ~lng,
    popup = ~paste("City:", city_state, "<br>Avg Salary:", round(AvgSalary, 2))
 )
m
```
```{r}
sessionInfo()
```
